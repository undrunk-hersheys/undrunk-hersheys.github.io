---
layout: post
title:  "stm32f103c8t6_fw"
date:   2025-03-01 18:53:00 +0900
categories: embedded
---

For the minimum file needed. -essential 
main.c  
:contains user code  
startup.s  
:contains initial reset code [reset_handler, reset routine, interrupte vector table], copy .data section, reset .bss data, set system clock 
link_script.ld  
:reorganize memeroy and code structure. set Flash/RAM size, set boundary of .text, .data, .bss, stack/heap.  
  
so for the firmware level design, those three files are nessasary.  
  
-not essentail but need to be there for the printf / malloc  
systemcalls.c
:when printf(), scanf() is used, need to call the system (_write, _read). But eversince embedded system do not have the OS, we need to define by ourselves. So by using UART to use printf(), need to implement _write().  

```
int _write(int file, char *ptr, int len) {
    for (int i = 0; i < len; i++) {
        USART_SendChar(ptr[i]); // send UART
    }
    return len;
}
```


So when the MCU is powered on, scpu start in the certain address (reset vector). Initialize reset memory, set system. Execute main(), while(1).  
What is interrupt vector table, reset routine?  
  
Interrupt Vector Table (IVT)  
: a tabel showing where the MCU should start. It is literally bunch of data table containing events like reset, interrupt is located. 

| Adress        | Words           | eg  |
| ------------- |:-------------:| -----:|
| 0x08000000	| Stack Pointer | $0x20002000  |
| 0x08000004    | Reset Handler      |   Reset_Handler()
 |
| 0x08000008    | NMI       |    NMI_Handler()
 |
  
MSP (main stack pointer) gives the end of RAM (start of stack) in general.  
Reset Handler is where the first code locates.  





